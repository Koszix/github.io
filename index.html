<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ninja Clicker</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="script.js"></script>
</head>
<body>
    <div class="container">
        <h1 class="title">Ninja Clicker</h1>
        <p class="score-text">Your Katanas: <span id="score">0</span></p>
        <button class="ninja-button" id="clickButton">
            <img src="ninja.png" alt="Ninja">
        </button>
    </div>

    <div class="bottom-bar">
        <button class="bottom-button" id="walletButton">üí≥ –ö–æ—à–µ–ª–µ–∫</button>
        <button class="bottom-button" id="profileButton">üë§ –ü—Ä–æ—Ñ–∏–ª—å</button>
        <button class="bottom-button" id="topButton">üèÜ –¢–æ–ø-100</button>
    </div>

    <div id="welcomeModal" class="modal hidden">
        <div class="modal-content">
            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
            <p>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è:</p>
            <input type="text" id="userName" placeholder="–í–∞—à–µ –∏–º—è">
            <button class="modal-button" id="saveNameButton">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>
    </div>

    <div id="walletPage" class="wallet-page hidden">
        <div class="wallet-content">
            <h2>–ü—Ä–∏–≤—è–∑–∫–∞ –∫–æ—à–µ–ª—å–∫–∞</h2>
            <button class="wallet-button" id="connectWallet">üí≥ –ü—Ä–∏–≤—è–∑–∞—Ç—å</button>
            <h2>–ö—É–ø–∏—Ç—å –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä</h2>
            <button class="wallet-button" id="buyAuto1">‚≠ê 1 —á–∞—Å (4,20$)</button>
            <button class="wallet-button" id="buyAuto4">‚≠ê 4 —á–∞—Å–∞ (12,30$)</button>
            <button class="wallet-button" id="buyAuto16">‚≠ê 16 —á–∞—Å–æ–≤ (37,10$)</button>
            <button class="close-button" id="closeWallet">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <div id="topModal" class="top-modal hidden">
        <div class="top-content">
            <h2>–¢–û–ü-100</h2>
            <div class="top-list" id="topList"></div>
            <button class="close-button" id="closeTop">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDKyhYxdcZUqz3HJC2NF97FLCuN7bndNH8",
            authDomain: "ninjatapp00.firebaseapp.com",
            projectId: "ninjatapp00",
            storageBucket: "ninjatapp00.firebasestorage.app",
            messagingSenderId: "253236416484",
            appId: "1:253236416484:web:db84e76d445fa7d1bdc1f1",
            measurementId: "G-PF0DESMGR9"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        const tg = window.Telegram.WebApp;
        tg.ready();

        const user = tg.initDataUnsafe.user;
        const userId = user?.id || 'user_' + Math.random().toString(36).substr(2, 9);
        const userName = user?.first_name || localStorage.getItem('userName');

        function saveUserData(userId, data) {
            set(ref(db, 'users/' + userId), data);
        }

        async function getUserData(userId) {
            const snapshot = await get(ref(db, 'users/' + userId));
            return snapshot.val();
        }

        let score = 0;
        let upgrades = { clickPower: 1, autoClicker: null };

        async function loadUserData() {
            const data = await getUserData(userId);
            if (data) {
                score = data.score || 0;
                upgrades = data.upgrades || { clickPower: 1, autoClicker: null };
                document.getElementById('score').textContent = score;
            }
        }

        loadUserData();

        document.getElementById('clickButton').addEventListener('click', () => {
            score += upgrades.clickPower;
            document.getElementById('score').textContent = score;
            saveUserData(userId, { score, name: userName, upgrades });
        });

        document.getElementById('saveNameButton').addEventListener('click', () => {
            const inputName = document.getElementById('userName').value.trim();
            if (!inputName) return alert("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è.");
            localStorage.setItem('userName', inputName);
            document.getElementById('welcomeModal').style.display = 'none';
            location.reload();
        });

        document.getElementById('walletButton').addEventListener('click', () => {
            document.getElementById('walletPage').style.display = 'flex';
        });

        document.getElementById('closeWallet').addEventListener('click', () => {
            document.getElementById('walletPage').style.display = 'none';
        });

        document.getElementById('topButton').addEventListener('click', async () => {
            const topList = document.getElementById('topList');
            topList.innerHTML = '';
            const snapshot = await get(ref(db, 'users'));
            const users = [];
            snapshot.forEach(child => {
                const data = child.val();
                users.push({ id: child.key, name: data.name || "–ê–Ω–æ–Ω–∏–º", score: data.score || 0 });
            });
            users.sort((a, b) => b.score - a.score);
            users.slice(0, 100).forEach((user, index) => {
                const userDiv = document.createElement('div');
                userDiv.textContent = `${index + 1}. ${user.name} - ${user.score} –ö–∞—Ç–∞–Ω`;
                topList.appendChild(userDiv);
            });
            document.getElementById('topModal').style.display = 'flex';
        });

        document.getElementById('closeTop').addEventListener('click', () => {
            document.getElementById('topModal').style.display = 'none';
        });
    </script>
</body>
</html>
